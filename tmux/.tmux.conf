# ==============================================================================
# Tmux Configuration
# ==============================================================================

# ------------------------------------------------------------------------------
# General
# ------------------------------------------------------------------------------
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm*:Tc"
set -sg escape-time 0

# Extended keys support (for Cmd key in nvim)
set -s extended-keys on
set -as terminal-features 'xterm*:extkeys'

# Shell: 일반 터미널과 동일하게 (interactive non-login shell로 실행)
set -g default-shell /bin/zsh
set -g default-command "zsh"
set -g history-limit 50000
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# ------------------------------------------------------------------------------
# Prefix Key: Ctrl+a (easier than Ctrl+b)
# ------------------------------------------------------------------------------
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# ------------------------------------------------------------------------------
# Session Navigation (SUPER EASY)
# ------------------------------------------------------------------------------
# Alt+s: session switcher (fzf style popup)
bind -n M-s choose-tree -Zs

# Alt+Left/Right: prev/next session
bind -n M-Left switch-client -p
bind -n M-Right switch-client -n

# Alt+1~9: switch to session by number (if you have few sessions)
# bind -n M-1 switch-client -t 1
# bind -n M-2 switch-client -t 2

# ------------------------------------------------------------------------------
# Window (Tab) Navigation (SUPER EASY)
# ------------------------------------------------------------------------------
# Alt+h/l or Alt+[/]: prev/next window
bind -n M-h previous-window
bind -n M-l next-window
bind -n M-[ previous-window
bind -n M-] next-window

# Alt+number: direct window switch
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5

# Alt+c: new window
bind -n M-c new-window -c "#{pane_current_path}"

# Alt+x: close window (with confirmation)
bind -n M-x confirm-before -p "kill window? (y/n)" kill-window

# ------------------------------------------------------------------------------
# Pane Navigation (if you ever split)
# ------------------------------------------------------------------------------
# Alt+arrow: move between panes
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Ctrl+a + hjkl: move between panes (vim style)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Split panes with | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# ------------------------------------------------------------------------------
# Quick Actions
# ------------------------------------------------------------------------------
# Ctrl+a + r: reload config
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Ctrl+a + d: detach
bind d detach-client

# Ctrl+a + z: zoom pane (toggle fullscreen)
bind z resize-pane -Z

# ------------------------------------------------------------------------------
# Status Bar (Dracula theme)
# ------------------------------------------------------------------------------
set -g status-position bottom
set -g status-style "bg=#282a36,fg=#f8f8f2"
set -g status-left-length 50
set -g status-right-length 50

# Left: session name
set -g status-left "#[fg=#282a36,bg=#bd93f9,bold] #S #[fg=#bd93f9,bg=#282a36]"

# Right: time
set -g status-right "#[fg=#6272a4]%H:%M "

# Window tabs
set -g window-status-format "#[fg=#6272a4] #I:#W "
set -g window-status-current-format "#[fg=#282a36,bg=#ff79c6,bold] #I:#W #[fg=#ff79c6,bg=#282a36]"

# Pane borders
set -g pane-border-style "fg=#6272a4"
set -g pane-active-border-style "fg=#ff79c6"

# ------------------------------------------------------------------------------
# Copy Mode (vim style)
# ------------------------------------------------------------------------------
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel

# macOS clipboard
if-shell "uname | grep -q Darwin" {
    bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"
    bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "pbcopy"
}
